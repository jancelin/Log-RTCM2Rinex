server {
  listen 80;
  server_name _;

  charset utf-8;

  # UI tuning
  # - Larger font for readability
  # - Keep autoindex but inject a small CSS block (sub_filter)
  # - Force downloads for files (Content-Disposition: attachment)
  # NOTE: sub_filter works only on non-gzipped responses. nginx:alpine has gzip OFF by default.

  # Accueil (HTML statique mont√© en read-only)
  location = / {
    root /usr/share/nginx/html;
    try_files /index.html =404;
  }

  # Normaliser sans slash final
  location = /centipede_30s { return 301 /centipede_30s/; }
  location = /centipede_1s  { return 301 /centipede_1s/; }

  # Expose uniquement ces 2 dossiers
  # 1) Directory listing (autoindex) + CSS injection
  location /centipede_30s/ {
    alias /srv/pub/centipede_30s/;
    autoindex on;
    autoindex_format html;
    autoindex_exact_size off;
    autoindex_localtime off;

    # Nginx autoindex uses <pre>; bump font size without custom modules.
    sub_filter_once on;
    sub_filter_types text/html;
    sub_filter '<head>' '<head><style>
      body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;font-size:18px;line-height:1.35;padding:12px;}
      pre{font-size:18px;}
      a{color:#0b57d0;text-decoration:none;}
      a:hover{text-decoration:underline;}
    </style>';
  }

  # 2) Files: force browser download (no inline preview)
  location ~ ^/centipede_30s/(.+[^/])$ {
    alias /srv/pub/centipede_30s/$1;
    types { }
    default_type application/octet-stream;
    add_header Content-Disposition 'attachment' always;
    add_header X-Content-Type-Options 'nosniff' always;
  }

  location /centipede_1s/ {
    alias /srv/pub/centipede_1s/;
    autoindex on;
    autoindex_format html;
    autoindex_exact_size off;
    autoindex_localtime off;

    sub_filter_once on;
    sub_filter_types text/html;
    sub_filter '<head>' '<head><style>
      body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;font-size:18px;line-height:1.35;padding:12px;}
      pre{font-size:18px;}
      a{color:#0b57d0;text-decoration:none;}
      a:hover{text-decoration:underline;}
    </style>';
  }

  location ~ ^/centipede_1s/(.+[^/])$ {
    alias /srv/pub/centipede_1s/$1;
    types { }
    default_type application/octet-stream;
    add_header Content-Disposition 'attachment' always;
    add_header X-Content-Type-Options 'nosniff' always;
  }

  # Tout le reste: interdit
  location / {
    return 404;
  }
}

